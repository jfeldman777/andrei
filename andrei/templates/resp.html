{% extends 'base.html' %}
{% load custom_filters %}
{% block content %}
<a href="/load/{{project.id}}">посмотреть потребные ресурсы</a>
<h2>{{project}}</h2>
{{d1}}-{{d2}}
<a href="/res/{{project.id}}">посмотреть распределенные ресурсы крупно</a>
<table>
<table border="2">
  <tr>
    <th  style="text-align: center;">Роль</th>
        <th  style="text-align: center;">Исполнитель</th>
    {% for y,m in month_tuples %}
      <th  style="text-align: center;  padding: 5px;">
        {{y}}<br>{{m}}
      </th>
   {% endfor %}

  </tr>
  {% for row in data %}
    <tr>
              {% for cell in row %}
             {% if cell|isObject  %}
                <td class="good" key="{{cell.link}}"
                    style="text-align: center; padding: 5px;background-color:yellow">
                        {{ cell.load }}
                               </td>
            {% else %}
                <td class="bad" style="text-align: center; padding: 5px; ">{{ cell }}</td>
            {% endif %}

      {% endfor %}
    </tr>
  {% endfor %}
</table>
<form id="myForm" action="/load5/" method="POST">

    {% csrf_token %}
  <input type = hidden name="id" value='{{project_id}}'>
    <button type="submit">Сохранить изменения</button>
  </form>

    <script>

$('td.good').click(function() {
console.log(1);
  var p = $(this).attr("key");
  var originalValue = $(this).text();
  $(this).html('<input type="text" value="' + originalValue + '">');
console.log(2);
  $(this).click(function(){
  $(this).html(originalValue);
  })

  $('td input').focusout(function() {
    var newValue = $(this).val();
    $(this).parent().text(newValue+'@');
var myForm = $("#myForm");
 var newInput = $("<input>");
    newInput.attr("type", "hidden");
    newInput.attr("name", p);
    newInput.attr("value",newValue );
    myForm.append(newInput);
  });
});

</script>
{% endblock %}